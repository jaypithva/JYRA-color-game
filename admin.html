<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Panel</title>
<link rel="stylesheet" href="styles.css">
<style>
body{visibility:hidden}
.card{background:#111;padding:14px;border-radius:16px;margin-bottom:14px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media(max-width:900px){.grid{grid-template-columns:1fr 1fr}}
@media(max-width:600px){.grid{grid-template-columns:1fr}}
.bet-card{background:#0b0b0b;border:1px solid #222;border-radius:14px;padding:12px;margin-bottom:10px}
.bet-card div{font-size:13px;margin-bottom:4px}
.table-wrap{overflow:auto}
@media(max-width:720px){.table-wrap{display:none}}
@media(min-width:721px){.bet-cards{display:none}}
</style>
</head>

<body>

<div class="container">
  <div class="card">
    <h2>Admin Panel</h2>
    <div id="who"></div>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="card" id="superBox" style="display:none">
    <h3>Super Admin</h3>
    <input id="aid" placeholder="Admin ID">
    <input id="aname" placeholder="Name">
    <input id="aphone" placeholder="Phone">
    <input id="apass" placeholder="Password">
    <button onclick="createAdmin()">Create Admin</button><br><br>
    <input id="pid" placeholder="Admin ID">
    <input id="pts" placeholder="Points">
    <button onclick="addPts()">Add Points</button>
    <div id="saMsg"></div>
  </div>

  <div class="card">
    <h3>Client Bet History</h3>
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr><th>Date</th><th>Bet</th><th>Result</th><th>Wallet</th></tr>
        </thead>
        <tbody id="histT"></tbody>
      </table>
    </div>
    <div class="bet-cards" id="histC"></div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<script>
window.firebaseConfig={
  apiKey:"AIzaSyBZFAk80TlzESxnFNlG0uonVyLj3bQ3PRo",
  authDomain:"wingo-app-f68dd.firebaseapp.com",
  projectId:"wingo-app-f68dd"
};
</script>

<script src="app.js"></script>

<script>
document.addEventListener("DOMContentLoaded",async()=>{
  const me=await requireAdminAsync();
  if(!me) return;

  document.body.style.visibility="visible";
  who.textContent = me.name+" ("+me.role+")";

  if(me.role==="superadmin") superBox.style.display="block";

  const users=await listAllUsers();
  const client=users.find(u=>u.role==="user");
  if(!client) return;

  const rows=await playsForUser(client.clientId,30);
  histT.innerHTML = rows.map(r=>`
    <tr><td>${r.createdAt}</td><td>${r.betLabel||"-"}</td><td>${r.result||"-"}</td><td>${r.before}→${r.after}</td></tr>
  `).join("");
  histC.innerHTML = rows.map(r=>`
    <div class="bet-card">
      <div>Date: ${r.createdAt}</div>
      <div>Bet: ${r.betLabel}</div>
      <div>Result: ${r.result}</div>
      <div>Wallet: ${r.before} → ${r.after}</div>
    </div>
  `).join("");
});

async function createAdmin(){
  const me=await currentUserAsync();
  const r=await superCreateAdmin({
    clientId:aid.value,
    name:aname.value,
    phone:aphone.value,
    password:apass.value
  }, me.clientId);
  saMsg.textContent = r.ok?"Admin Created":r.msg;
}
async function addPts(){
  const me=await currentUserAsync();
  const r=await superAddAdminPoints(pid.value,Number(pts.value),me.clientId);
  saMsg.textContent = r.ok?"Points Added":r.msg;
}
</script>
</body>
</html>
