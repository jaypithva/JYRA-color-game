<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<div class="container" style="max-width:480px;margin:80px auto;">
  <div class="card">
    <h2>Login</h2>

    <div class="input">
      <label>Phone / Client ID</label>
      <input id="pid" autocomplete="off">
    </div>

    <div class="input">
      <label>Password</label>
      <input id="pass" type="password">
    </div>

    <button id="btnLogin" class="btn">Login</button>

    <div id="msg" class="notice" style="display:none;margin-top:10px;"></div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBZFAk80TlzESxnFNlG0uonVyLj3bQ3PRo",
  authDomain: "wingo-app-f68dd.firebaseapp.com",
  projectId: "wingo-app-f68dd"
});
</script>

<script src="app.js"></script>

<script>
const msg = document.getElementById("msg");
const btn = document.getElementById("btnLogin");

function show(m){
  msg.style.display="block";
  msg.textContent=m;
}

btn.onclick = async function(e){
  e.preventDefault();      // ðŸ”¥ VERY IMPORTANT
  e.stopPropagation();     // ðŸ”¥ NO REFRESH

  msg.style.display="none";

  const pid = pidEl.value.trim();
  const pass = passEl.value.trim();

  if(!pid || !pass){
    show("Enter ID and password");
    return;
  }

  btn.disabled = true;

  const res = await loginSecure({
    phoneOrId: pid,
    password: pass
  });

  btn.disabled = false;

  if(!res || !res.ok){
    show(res?.msg || "Login failed");
    return;
  }

  // âœ… SAVE SESSION
  localStorage.setItem("jyra_user", JSON.stringify(res.user));

  // âœ… REDIRECT
  if(res.user.role === "admin"){
    location.href = "admin.html";
  } else {
    location.href = "game.html";
  }
};

// ENTER KEY FIX
document.addEventListener("keydown", e=>{
  if(e.key==="Enter") btn.click();
});
</script>

</body>
</html>
