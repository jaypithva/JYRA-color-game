<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game</title>
  <link rel="icon" type="image/x-icon" href="images/logo.png">
  <link rel="stylesheet" href="styles.css" />

  <style>
    body{visibility:hidden}

    :root{
      --bg:#060712;
      --panel: rgba(255,255,255,.04);
      --panel2: rgba(0,0,0,.25);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(212,175,55,.24);
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.70);

      --gold1:#f4d47a;
      --gold2:#caa34c;
      --neon1:#6d4cff;
      --neon2:#2be7ff;

      --green1:#16a34a; --green2:#22c55e;
      --red1:#dc2626; --red2:#ef4444;
      --vio1:#7c3aed; --vio2:#a855f7;

      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --shadow2: 0 18px 60px rgba(0,0,0,.45);
      --r: 22px;
      --r2: 16px;

      --brand: var(--gold2);
      --brand2: var(--neon1);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 50% -10%, rgba(109,76,255,.25), transparent 60%),
        radial-gradient(700px 400px at 85% 25%, rgba(43,231,255,.16), transparent 60%),
        radial-gradient(700px 520px at 20% 35%, rgba(244,212,122,.14), transparent 60%),
        linear-gradient(180deg, #040510 0%, #090a18 60%, #040510 100%);
      overflow-x:hidden;
    }

    .container{
      /* width:min(1200px, 92vw); */
      margin:0 auto;
    }

    .nav{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.22));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }

    .row{display:flex; align-items:center}
    .header-row{
      padding:12px 0;
      justify-content:space-between;
      gap:12px;
    }

    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:44px; height:44px; border-radius:14px;
      object-fit:cover;
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 28px rgba(0,0,0,.45);
    }
    .brand-title{
      display:flex; flex-direction:column; line-height:1.1
    }
    .brand-title b{
      letter-spacing:.8px;
      background: linear-gradient(90deg, var(--gold1), var(--gold2), var(--neon2));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      font-size:16px;
    }
    .brand-title span{
      font-size:12px; color:var(--muted)
    }

    .btn{
      border:0;
      cursor:pointer;
      color:#101318;
      font-weight:900;
      padding:11px 14px;
      border-radius:14px;
      background: linear-gradient(135deg, var(--gold1), var(--gold2));
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); filter:brightness(1.05)}
    .btn:active{transform: translateY(0px); filter:brightness(.98)}
    .btn.small{padding:9px 12px; border-radius:12px; font-size:12px}
    .btn.secondary{
      color:var(--text);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
    }
    .btn.secondary:hover{background: rgba(255,255,255,.09)}

    .row-actions{display:flex; gap:10px; align-items:center}

    .card{
      margin-top:14px;
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(650px 220px at 50% 0%, rgba(244,212,122,.10), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.22));
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .card-inner{padding:14px}

    .h2{
      font-weight:1000;
      letter-spacing:.4px;
      margin:0 0 8px 0;
      font-size:18px;
    }
    .small{font-size:12px; color:var(--muted)}
    .hr{height:1px;background:rgba(255,255,255,.08);margin:14px 0}

    .kpi{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:10px;
      margin-top:10px;
    }
    .box{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding:12px;
    }
    .label{font-size:12px; color:rgba(255,255,255,.72)}
    .val{
      margin-top:6px;
      font-size:18px;
      font-weight:1100;
      letter-spacing:.5px;
      color:#eaf0ff;
      word-break:break-word;
    }

    /* ===== HERO header inside game card ===== */
    .wg-hero{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      align-items:stretch;
      padding:14px;
    }
    .wg-hero-left{
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(420px 220px at 50% 0%, rgba(109,76,255,.25), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.22));
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
      min-height:190px;
    }
    .wg-hero-bg{
      position:absolute; inset:0;
      background:
        radial-gradient(700px 260px at 50% 20%, rgba(244,212,122,.14), transparent 70%),
        linear-gradient(135deg, rgba(0,0,0,.15), rgba(0,0,0,.35));
      pointer-events:none;
    }
    .wg-hero-content{
      position:relative;
      padding:16px;
      display:flex;
      align-items:center;
      gap:14px;
    }
    .wg-hero-logo{
      width:86px; height:86px; border-radius:24px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      padding:10px;
      display:grid; place-items:center;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .wg-hero-logo img{width:100%; height:100%; object-fit:contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,.35))}
    .wg-hero-text{flex:1}
    .wg-hero-title{
      font-size:22px;
      font-weight:1100;
      margin:0;
      letter-spacing:.8px;
      background: linear-gradient(90deg, var(--gold1), var(--gold2), var(--neon2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .wg-hero-sub{margin-top:6px; color:var(--muted); font-size:12px; line-height:1.35}
    .wg-hero-meta{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .wg-chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);font-weight:900;font-size:12px;color:rgba(255,255,255,.92);white-space:nowrap}
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .dot-live{background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.12)}
    .dot-lock{background:#f59e0b;box-shadow:0 0 0 4px rgba(245,158,11,.12)}
    .dot-end{background:#ef4444;box-shadow:0 0 0 4px rgba(239,68,68,.12)}

    .wg-meta{padding:10px 12px;border-radius:16px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);min-width:180px}
    .wg-meta-label{font-size:12px;color:rgba(255,255,255,.65)}
    .wg-meta-value{margin-top:4px;font-size:16px;font-weight:1000;letter-spacing:.6px;color:#e8efff;word-break:break-word}

    /* right timer */
    .wg-timer{
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(520px 200px at 60% 0%, rgba(43,231,255,.18), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.22));
      box-shadow: var(--shadow2);
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:190px;
    }

    .wg-tabs{display:flex;gap:10px;flex-wrap:wrap}
    .wg-tab{
      padding:10px 14px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      font-weight:1000;
      flex:1;
      min-width:140px;
      transition: transform .12s ease, background .12s ease, border .12s ease;
    }
    .wg-tab:hover{transform: translateY(-1px)}
    .wg-tab.active{
      background: linear-gradient(135deg, rgba(244,212,122,.95), rgba(202,163,76,.92));
      color:#0c0f16;
      border:0;
    }

    .wg-timer-title{font-size:12px;color:rgba(255,255,255,.70);font-weight:1000}
    .wg-timer-time{margin-top:6px;display:flex;align-items:center;justify-content:flex-end;gap:6px}
    .wg-t{
      width:52px;height:58px;
      display:flex;align-items:center;justify-content:center;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      font-weight:1200;font-size:30px;
      box-shadow: inset 0 0 0 1px rgba(244,212,122,.10);
    }
    .wg-colon{font-weight:1200;font-size:26px;opacity:.9;margin:0 2px}
    .wg-timer-sub{font-size:12px;color:rgba(255,255,255,.70);text-align:right}

    .wg-progress{height:10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);overflow:hidden}
    .wg-progress-bar{height:100%;border-radius:999px;background:linear-gradient(90deg,rgba(34,197,94,.95),rgba(255,59,59,.95));transition:width .25s ease;width:0%}

    /* ===== Main grid ===== */
    .grid.two{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      padding:14px;
    }
    .panel{
      border-radius: var(--r);
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(520px 220px at 50% 0%, rgba(109,76,255,.14), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.22));
      box-shadow: var(--shadow2);
      padding:14px;
    }

    /* inputs */
    .input{margin-top:10px}
    .input label{display:block;font-size:12px;color:rgba(255,255,255,.72);font-weight:900;margin-bottom:6px}
    .input input{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-weight:900;
      letter-spacing:.2px;
    }
    .input input::placeholder{color:rgba(255,255,255,.35)}

    /* selection */
    .wg-colors{display:flex;gap:10px;flex-wrap:wrap}
    .wg-color{
      padding:11px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:#fff;
      cursor:pointer;
      font-weight:1000;
      flex:1;
      min-width:140px;
      transition: transform .12s ease, filter .12s ease;
    }
    .wg-color:hover{transform: translateY(-1px); filter:brightness(1.05)}
    .wg-color.green{background:linear-gradient(135deg,var(--green1),var(--green2));border:0}
    .wg-color.red{background:linear-gradient(135deg,var(--red1),var(--red2));border:0}
    .wg-color.violet{background:linear-gradient(135deg,var(--vio1),var(--vio2));border:0}

    .wg-color.active,.wg-num.active,.wg-bs-btn.active{outline:3px solid rgba(244,212,122,.35)}

    .wg-numbers{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    .wg-num{
      height:46px;border-radius:999px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:#fff;
      font-weight:1100;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    .wg-num:hover{transform: translateY(-1px); background: rgba(255,255,255,.08)}

    .wg-bs{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .wg-bs-btn{
      padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:#fff;
      font-weight:1100;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    .wg-bs-btn:hover{transform: translateY(-1px); filter:brightness(1.05)}
    .wg-bs-btn.big{background:linear-gradient(135deg,#f59e0b,#fbbf24);border:0;color:#111827}
    .wg-bs-btn.small{background:linear-gradient(135deg,#3b82f6,#60a5fa);border:0}

    .bet-lock{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.03);color:var(--muted);font-size:12px}
    .bet-open{color:#86efac}
    .bet-closed{color:#fca5a5}

    /* chips row */
    .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .chipbtn{
      padding:10px 12px;border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(120px 60px at 30% 25%, rgba(255,255,255,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.20));
      color:#fff;font-weight:1100;cursor:pointer;min-width:72px;text-align:center;
      box-shadow: inset 0 0 0 1px rgba(244,212,122,.10);
      transition: transform .12s ease, background .12s ease, filter .12s ease;
    }
    .chipbtn:hover{transform: translateY(-1px); filter:brightness(1.05); background: rgba(255,255,255,.08)}

    .notice{
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.9);
      font-weight:900;
    }

    /* Last5 */
    .last5{margin-top:10px;border-radius:18px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.14);overflow:hidden}
    .last5-row{display:flex;justify-content:space-between;gap:10px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08)}
    .last5-row:last-child{border-bottom:0}
    .last5-per{font-weight:1100;opacity:.95}
    .last5-res{opacity:.9;text-align:right}

    /* table */
    .table{width:100%; border-collapse:separate; border-spacing:0; min-width:780px}
    .table thead th{
      text-align:left;
      font-size:12px;
      color:rgba(255,255,255,.78);
      padding:12px 12px;
      background: rgba(0,0,0,.22);
      border-bottom:1px solid rgba(255,255,255,.10);
      position:sticky; top:0;
    }
    .table tbody td{
      padding:11px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color:rgba(255,255,255,.92);
      font-size:12px;
      white-space:nowrap;
    }

    /* popup same (kept) */
    .pop-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:999}
    .pop{width:min(420px,100%);border-radius:22px;overflow:hidden;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,rgba(255,72,72,.95),rgba(255,190,120,.20));box-shadow:0 30px 80px rgba(0,0,0,.55)}
    .pop-top{padding:18px 16px 14px;text-align:center;background:linear-gradient(180deg,rgba(255,120,80,.95),rgba(255,60,60,.95))}
    .pop-title{font-size:20px;font-weight:1000;color:#fff}
    .pop-sub{margin-top:8px;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.20);color:#fff;font-weight:800;font-size:12px;border:1px solid rgba(255,255,255,.22)}
    .pop-body{background:rgba(11,18,32,.65);padding:16px}
    .ticket{border-radius:20px;background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.12);padding:14px}
    .bonus{font-size:28px;font-weight:1000;color:#fff;text-align:center;margin:6px 0}
    .bonus.lose{color:#fecaca}
    .periodline{color:rgba(255,255,255,.85);font-size:12px;text-align:center}
    .pop-actions{display:flex;justify-content:center;padding:14px}
    .pop-actions .btn{min-width:140px}

    /* ===== responsive ===== */
    @media (max-width: 980px){
      .wg-hero{grid-template-columns:1fr}
      .grid.two{grid-template-columns:1fr}
      .table{min-width:720px}
    }
    @media (max-width: 700px){
      .kpi{grid-template-columns:1fr; }
      .wg-timer-time{justify-content:space-between}
      .wg-tab{min-width:0}
      .wg-meta{min-width:100%}
    }
    @media (max-width: 420px){
      .wg-t{width:44px;height:52px;font-size:26px;border-radius:14px}
      .wg-numbers{grid-template-columns:repeat(4,1fr)}
      .wg-color{min-width:100%}
    }
    @media (max-width: 360px){
      .wg-numbers{grid-template-columns:repeat(3,1fr)}
    }
  </style>
</head>

<body>
  <!-- ===== Header ===== -->
  <div class="nav">
    <div class="container">
      <div class="row header-row">
        <div class="brand">
          <a href="index.html"><img src="logo.png" alt="Logo" class="logo"></a>
          <div class="brand-title">
            <b>JYRA</b>
            <span>Win Go ‚Ä¢ Premium UI</span>
          </div>
        </div>
        <div class="row-actions">
          <button class="btn secondary small" id="btnLogout" type="button">Logout</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container">

    <!-- ===== Wallet ===== -->
    <div class="card">
      <div class="card-inner">
        <div class="h2">My Wallet</div>
        <div class="kpi">
          <div class="box">
            <div class="label">Client ID</div>
            <div class="val" id="cid">-</div>
          </div>
          <div class="box">
            <div class="label">Name</div>
            <div class="val" id="nm">-</div>
          </div>
          <div class="box">
            <div class="label">Balance</div>
            <div class="val" id="pts">0</div>
            <div class="small" id="ptsInr" style="margin-top:6px;">‚Çπ0.00</div>
          </div>
        </div>

        <div class="small" style="margin-top:12px;">
          Min Bet: <b>50</b> | Max Bet: <b>Wallet Balance</b> |
          <span class="bet-lock" id="betWindow">Betting: <b class="bet-open">OPEN</b> (first 30 sec)</span>
        </div>
      </div>
    </div>

    <!-- ===== Game ===== -->
    <div class="card">
      <!-- HERO -->
      <div class="wg-hero">
        <div class="wg-hero-left">
          <div class="wg-hero-bg"></div>
          <div class="wg-hero-content">
            <div class="wg-hero-logo">
              <img src="logo.png" alt="Logo">
            </div>
            <div class="wg-hero-text">
              <h1 class="wg-hero-title" style="margin:0;">Win Go</h1>
              <div class="wg-hero-sub">Choose Color / Number / Big-Small. Result at round end. Same logic, new premium UI.</div>

              <div class="wg-hero-meta">
                <div class="wg-chip" aria-live="polite">
                  <span class="dot dot-live" id="wgDot"></span>
                  <span id="wgStatusText">LIVE</span>
                </div>

                <div class="wg-meta">
                  <div class="wg-meta-label">Period</div>
                  <div class="wg-meta-value" id="periodId">-</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="wg-timer">
          <div class="wg-tabs">
            <button class="wg-tab active" id="tab1m" type="button">1 Min</button>
            <button class="wg-tab" id="tab3m" type="button">3 Min</button>
          </div>

          <div>
            <div class="wg-timer-title">Remaining</div>
            <div class="wg-timer-time" role="timer" aria-live="polite">
              <span class="wg-t" id="tm_m1">0</span>
              <span class="wg-t" id="tm_m2">0</span>
              <span class="wg-colon">:</span>
              <span class="wg-t" id="tm_s1">0</span>
              <span class="wg-t" id="tm_s2">0</span>
            </div>
            <div class="wg-timer-sub" id="wgTimerHint">Place bets before time ends</div>
          </div>

          <div class="wg-progress">
            <div class="wg-progress-bar" id="wgProgressBar"></div>
          </div>
        </div>
      </div>

      <div class="hr" style="margin:0;"></div>

      <div class="grid two">
        <!-- LEFT -->
        <div class="panel">
          <div class="h2" style="margin-top:0;">Select Bet</div>

          <div class="small" style="margin-bottom:8px;">Color</div>
          <div class="wg-colors">
            <button class="wg-color green" id="btnGreen" type="button">Green</button>
            <button class="wg-color violet" id="btnViolet" type="button">Violet</button>
            <button class="wg-color red" id="btnRed" type="button">Red</button>
          </div>

          <div class="hr"></div>

          <div class="small" style="margin-bottom:8px;">Number (0-9)</div>
          <div class="wg-numbers" id="numGrid"></div>

          <div class="hr"></div>

          <div class="small" style="margin-bottom:8px;">Big / Small</div>
          <div class="wg-bs">
            <button class="wg-bs-btn big" id="btnBig" type="button">Big</button>
            <button class="wg-bs-btn small" id="btnSmall" type="button">Small</button>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="panel">
          <div class="h2" style="margin-top:0;">Place Bet</div>

          <div class="input">
            <label>Selected Bet</label>
            <input id="selBet" readonly placeholder="Choose any one option" />
          </div>

          <div class="input">
            <label>Bet Amount (min 50)</label>
            <input id="betAmt" type="number" min="50" placeholder="Enter points" />
            <div class="small" id="betAmtInr" style="margin-top:6px;">‚Çπ0.00</div>

            <div class="chips" id="chipsRow">
              <button class="chipbtn" type="button" data-chip="50">50</button>
              <button class="chipbtn" type="button" data-chip="100">100</button>
              <button class="chipbtn" type="button" data-chip="200">200</button>
              <button class="chipbtn" type="button" data-chip="500">500</button>
              <button class="chipbtn" type="button" data-chip="1000">1000</button>
            </div>
          </div>

          <div class="row-actions" style="margin-top:12px;">
            <button class="btn" id="btnBet" type="button">Confirm Bet</button>
            <button class="btn secondary" id="btnClear" type="button">Clear</button>
          </div>

          <div class="notice" id="betMsg" style="display:none;margin-top:10px;"></div>

          <div class="hr"></div>

          <div class="h2" style="margin-top:0;">Latest Result</div>
          <div class="kpi">
            <div class="box">
              <div class="label">Number</div>
              <div class="val" id="resNum">-</div>
            </div>
            <div class="box">
              <div class="label">Color</div>
              <div class="val" id="resColor">-</div>
            </div>
            <div class="box">
              <div class="label">Big/Small</div>
              <div class="val" id="resBS">-</div>
            </div>
          </div>

          <div class="notice" id="roundMsg" style="display:none;margin-top:10px;"></div>

          <div class="hr"></div>

          <div class="h2" style="margin-top:0;">Last 5 Results</div>
          <div class="small" style="opacity:.85">All users (even without bet)</div>
          <div class="last5" id="last5Box">
            <div class="last5-row"><div class="small">Loading‚Ä¶</div></div>
          </div>

          <div class="hr"></div>
          <div class="small">Rule: Bet place hote hi amount minus hota hai. Win pe <b>+2x</b> add hota hai.</div>
        </div>
      </div>
    </div>

    <!-- ===== History (BET HISTORY) ===== -->
    <div class="card">
      <div class="card-inner">
        <div class="row-actions" style="justify-content:space-between;">
          <div>
            <div class="h2" style="margin:0;">Game History</div>
            <div class="small">Last 30 records</div>
          </div>
          <button class="btn secondary small" id="btnRefresh" type="button">Refresh</button>
        </div>

        <div style="overflow:auto;margin-top:12px;border-radius:18px;border:1px solid rgba(255,255,255,.08);">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Period</th>
                <th>Mode</th>
                <th>Bet</th>
                <th>Result</th>
                <th>Before</th>
                <th>After</th>
              </tr>
            </thead>
            <tbody id="histBody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- ===== Result Popup ===== -->
  <div class="pop-backdrop" id="popBack">
    <div class="pop" role="dialog" aria-modal="true">
      <div class="pop-top">
        <div class="pop-title" id="popTitle">Congratulations</div>
        <div class="pop-sub" id="popChips"></div>
      </div>
      <div class="pop-body">
        <div class="ticket">
          <div class="small" style="text-align:center;color:rgba(255,255,255,.85)">Bonus</div>
          <div class="bonus" id="popBonus">‚Çπ0.00</div>
          <div class="periodline" id="popPeriod">Period: -</div>
        </div>
      </div>
      <div class="pop-actions">
        <button class="btn" id="popOk" type="button">OK</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Firebase SDK FIRST -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    window.firebaseConfig = {
      apiKey: "AIzaSyBZFAk80TlzESxnFNlG0uonVyLj3bQ3PRo",
      authDomain: "wingo-app-f68dd.firebaseapp.com",
      projectId: "wingo-app-f68dd",
      storageBucket: "wingo-app-f68dd.firebasestorage.app",
      messagingSenderId: "533037771285",
      appId: "1:533037771285:web:d72372f86108a8379dbc1c",
      measurementId: "G-RJ1XX4FX3W"
    };
  </script>

  <script src="app.js"></script>

  <script>
    // ‚úÖ If any error happens, don't keep page hidden
    window.addEventListener("error", function () {
      document.body.style.visibility = "visible";
    });

    function fmtINR(n) {
      n = Number(n || 0);
      return "‚Çπ" + n.toLocaleString("en-IN", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    function setText(id, text) { var el = document.getElementById(id); if (el) el.textContent = text; }
    function showMsg(id, text) { var el = document.getElementById(id); if (el) { el.style.display = "block"; el.textContent = text; } }
    function hideMsg(id) { var el = document.getElementById(id); if (el) { el.style.display = "none"; el.textContent = ""; } }
    function pad2(n) { return (n < 10 ? "0" : "") + n; }
    function pad4(n) { return String(n).padStart(4, "0"); }

    // ===== PERIOD (IST) 30-sec index =====
    function istNow() {
      var now = new Date();
      var utcMs = now.getTime() + (now.getTimezoneOffset() * 60000);
      return new Date(utcMs + (5.5 * 3600000));
    }
    function ymdIST(d) { return "" + d.getFullYear() + pad2(d.getMonth() + 1) + pad2(d.getDate()); }
    function secondsSinceISTMidnight() {
      var d = istNow();
      return (d.getHours() * 3600) + (d.getMinutes() * 60) + d.getSeconds();
    }
    function periodFromIstSeconds(secSinceMidnight) {
      var d = istNow();
      var idx = Math.floor(secSinceMidnight / 30) + 1; // 1..2880
      return ymdIST(d) + "-" + pad4(idx);
    }
    function currentPeriodIST() { return periodFromIstSeconds(secondsSinceISTMidnight()); }
    function periodAtOffsetSeconds(offsetSec) {
      var d = istNow();
      var base = secondsSinceISTMidnight();
      var target = base + Number(offsetSec || 0);
      while (target < 0) { target += 86400; }
      while (target >= 86400) { target -= 86400; }
      var idx = Math.floor(target / 30) + 1;
      return ymdIST(d) + "-" + pad4(idx);
    }

    // ===== Deterministic result for a period (same everywhere) =====
    var RESULT_CACHE = {};
    function numberToColor(n) {
      if (n === 0 || n === 5) return "Violet";
      if (n === 1 || n === 3 || n === 7 || n === 9) return "Green";
      return "Red";
    }
    function numberToBigSmall(n) { return (n >= 5) ? "Big" : "Small"; }

    async function resultForPeriod(period) {
      if (RESULT_CACHE[period]) return RESULT_CACHE[period];
      if (!window.sha256) throw new Error("sha256 not found (app.js not loaded)");
      var hex = await sha256(String(period));
      var n = parseInt(hex.slice(0, 8), 16) % 10;
      var r = { period: period, resultNumber: n, resultColor: numberToColor(n), resultBigSmall: numberToBigSmall(n) };
      RESULT_CACHE[period] = r;
      return r;
    }

    // ===== Game State =====
    var USER = null;
    var MODE_SEC = 60;   // 1 min default
    var remain = 60;
    var timer = null;

    var BET_OPEN_SEC = 30;
    var activeBet = null;
    var selectedBet = null;

    var lastSettledKey = null;

    function bettingAllowed() { return Number(remain || 0) > (MODE_SEC - BET_OPEN_SEC); }

    function updateBetWindowUI() {
      var el = document.getElementById("betWindow");
      if (!el) return;
      if (bettingAllowed()) el.innerHTML = 'Betting: <b class="bet-open">OPEN</b> (first 30 sec)';
      else el.innerHTML = 'Betting: <b class="bet-closed">CLOSED</b> (wait next round)';
    }

    function clearSelectionUI() {
      var all = document.querySelectorAll(".wg-num, .wg-bs-btn, .wg-color");
      for (var i = 0; i < all.length; i++) all[i].classList.remove("active");
    }

    function setSelectedBet(bet) {
      selectedBet = bet;
      var inp = document.getElementById("selBet");
      if (inp) inp.value = bet ? bet.label : "";
      hideMsg("betMsg");
    }

    function setTimerUI(remainSec, totalSec) {
      remainSec = Math.max(0, Number(remainSec) || 0);
      totalSec = Math.max(1, Number(totalSec) || 1);

      var mm = pad2(Math.floor(remainSec / 60));
      var ss = pad2(remainSec % 60);

      var m1 = document.getElementById("tm_m1"), m2 = document.getElementById("tm_m2");
      var s1 = document.getElementById("tm_s1"), s2 = document.getElementById("tm_s2");
      if (m1) m1.textContent = mm[0];
      if (m2) m2.textContent = mm[1];
      if (s1) s1.textContent = ss[0];
      if (s2) s2.textContent = ss[1];

      var done = totalSec - remainSec;
      var pct = Math.min(100, Math.max(0, (done / totalSec) * 100));
      var bar = document.getElementById("wgProgressBar");
      if (bar) bar.style.width = pct + "%";

      var dot = document.getElementById("wgDot");
      var hint = document.getElementById("wgTimerHint");
      var status = document.getElementById("wgStatusText");

      if (remainSec <= 0) {
        if (dot) dot.className = "dot dot-end";
        if (status) status.textContent = "ENDED";
        if (hint) hint.textContent = "Result generating‚Ä¶";
        return;
      }

      if (bettingAllowed()) {
        if (dot) dot.className = "dot dot-live";
        if (status) status.textContent = "LIVE";
        if (hint) hint.textContent = "Place bets before time ends";
      } else {
        if (dot) dot.className = "dot dot-lock";
        if (status) status.textContent = "LOCKED";
        if (hint) hint.textContent = "Bet locked (wait next round)";
      }
    }

    function remainingInModeBlock() {
      var s = secondsSinceISTMidnight();
      var into = s % MODE_SEC;
      return (MODE_SEC - into) % MODE_SEC;
    }

    async function renderWallet() {
      const me = await currentUserAsync();
      if (!me) return;
      setText("cid", me.clientId || "-");
      setText("nm", me.name || "-");
      var pts = (typeof me.points === "number") ? me.points : 0;
      setText("pts", String(pts));
      setText("ptsInr", fmtINR(pts));
    }

    async function renderHistory() {
      const me = await currentUserAsync();
      if (!me) return;

      const rows = await playsForUser(me.clientId, 30);
      var tb = document.getElementById("histBody");
      if (!tb) return;

      if (rows.length === 0) {
        tb.innerHTML = '<tr><td colspan="7" class="small">No history yet.</td></tr>';
        return;
      }

      tb.innerHTML = rows.map(function (r) {
        var resNum = (r.resultNumber === 0 || r.resultNumber) ? r.resultNumber : "-";
        var resCol = r.resultColor || "-";
        var resBS = r.resultBigSmall || "-";

        return "<tr>" +
          "<td>" + fmtDate(r.createdAt) + "</td>" +
          "<td>" + (r.period || "-") + "</td>" +
          "<td>" + (r.modeLabel || "-") + "</td>" +
          "<td>" + (r.betLabel || "-") + " (" + (r.betAmount || 0) + ")</td>" +
          "<td>" + (resNum + " / " + resCol + " / " + resBS) + "</td>" +
          "<td>" + (r.before || 0) + "</td>" +
          "<td>" + (r.after || 0) + "</td>" +
          "</tr>";
      }).join("");
    }

    function showResultPopup(o) {
      var back = document.getElementById("popBack");
      var title = document.getElementById("popTitle");
      var chips = document.getElementById("popChips");
      var bonus = document.getElementById("popBonus");
      var per = document.getElementById("popPeriod");

      if (title) title.textContent = o.win ? "Congratulations" : "Better Luck Next Time";
      if (chips) {
        chips.innerHTML =
          '<span class="chip">Lottery results</span>' +
          '<span class="chip">' + o.color + '</span>' +
          '<span class="chip">' + o.num + '</span>' +
          '<span class="chip">' + o.bs + '</span>';
      }
      if (bonus) {
        bonus.textContent = o.bonusText || "‚Çπ0.00";
        bonus.classList.toggle("lose", !o.win);
      }
      if (per) per.textContent = "Period: " + (o.period || "-");
      if (back) back.style.display = "flex";
    }

    function hideResultPopup() {
      var back = document.getElementById("popBack");
      if (back) back.style.display = "none";
    }

    async function renderLast5() {
      var box = document.getElementById("last5Box");
      if (!box) return;

      var arr = [];
      for (var i = 1; i <= 5; i++) arr.push(periodAtOffsetSeconds(-30 * i));

      var rows = [];
      for (var k = 0; k < arr.length; k++) rows.push(await resultForPeriod(arr[k]));

      box.innerHTML = rows.map(function (r) {
        return (
          "<div class='last5-row'>" +
            "<div class='last5-per'>" + r.period + "</div>" +
            "<div class='last5-res'>" + r.resultNumber + " / " + r.resultColor + " / " + r.resultBigSmall + "</div>" +
          "</div>"
        );
      }).join("");
    }

    async function settleAtZeroOnly() {
      if (Number(remain || 0) !== 0) return;

      var key = ymdIST(istNow()) + "|" + MODE_SEC + "|" + secondsSinceISTMidnight();
      if (lastSettledKey === key) return;
      lastSettledKey = key;

      var endedPeriod = periodAtOffsetSeconds(-1);
      var r = await resultForPeriod(endedPeriod);

      setText("resNum", String(r.resultNumber));
      setText("resColor", r.resultColor);
      setText("resBS", r.resultBigSmall);

      if (!activeBet) {
        showMsg("roundMsg", "Round ended. No bet placed.");
        showResultPopup({ win: false, period: endedPeriod, num: r.resultNumber, color: r.resultColor, bs: r.resultBigSmall, bonusText: fmtINR(0) });
        return;
      }

      var isWin = false;
      if (activeBet.type === "color") isWin = (String(activeBet.value).toLowerCase() === String(r.resultColor).toLowerCase());
      if (activeBet.type === "number") isWin = (Number(activeBet.value) === Number(r.resultNumber));
      if (activeBet.type === "bs") isWin = (String(activeBet.value).toLowerCase() === String(r.resultBigSmall).toLowerCase());

      if (isWin) await adjustPoints(USER.clientId, activeBet.amount * 2, "Win reward (2x)", null);

      const me = await currentUserAsync();
      const after = me ? (me.points || 0) : 0;

      await addPlayRow({
        userId: USER.clientId,
        createdAt: new Date().toISOString(),
        period: activeBet.period,
        modeSec: activeBet.modeSec,
        modeLabel: (activeBet.modeSec === 60 ? "1 Min" : "3 Min"),
        betType: activeBet.type,
        betValue: activeBet.value,
        betLabel: activeBet.label,
        betAmount: activeBet.amount,
        resultNumber: r.resultNumber,
        resultColor: r.resultColor,
        resultBigSmall: r.resultBigSmall,
        result: isWin ? "WIN" : "LOSE",
        before: activeBet.beforePoints,
        after: after
      });

      showMsg("roundMsg", isWin ? "üéâ WIN! Reward added (2x)." : "‚ùå LOSE! Bet deducted.");
      await renderWallet();
      await renderHistory();

      var bonusVal = isWin ? (activeBet.amount * 2) : (-activeBet.amount);
      showResultPopup({
        win: isWin,
        period: endedPeriod,
        num: r.resultNumber,
        color: r.resultColor,
        bs: r.resultBigSmall,
        bonusText: (bonusVal < 0 ? ("-" + fmtINR(Math.abs(bonusVal))) : fmtINR(bonusVal))
      });

      activeBet = null;
    }

    async function confirmBet() {
      const me = await currentUserAsync();
      if (!me) return;

      if (!bettingAllowed()) { showMsg("betMsg", "Betting closed for this round. Wait next round."); return; }

      var amt = Number(document.getElementById("betAmt").value);

      if (!selectedBet) return showMsg("betMsg", "Please select Color / Number / Big-Small.");
      if (!amt || amt < 50) return showMsg("betMsg", "Minimum bet is 50.");
      if (amt > (me.points || 0)) return showMsg("betMsg", "Insufficient wallet points.");
      if (activeBet) return showMsg("betMsg", "You already placed bet in this round.");

      var before = me.points || 0;
      var r = await adjustPoints(me.clientId, -amt, "Bet entry (" + selectedBet.label + ")", null);
      if (!r || !r.ok) return showMsg("betMsg", (r && r.msg) ? r.msg : "Bet failed");

      activeBet = { type: selectedBet.type, value: selectedBet.value, label: selectedBet.label, amount: amt, period: currentPeriodIST(), modeSec: MODE_SEC, beforePoints: before };

      showMsg("betMsg", "Bet placed: " + selectedBet.label + " (" + amt + "). Wait for result.");
      await renderWallet();
    }

    function setMode(sec) {
      MODE_SEC = sec;
      var t1 = document.getElementById("tab1m");
      var t3 = document.getElementById("tab3m");
      if (t1 && t3) {
        if (sec === 60) { t1.classList.add("active"); t3.classList.remove("active"); }
        else { t3.classList.add("active"); t1.classList.remove("active"); }
      }
    }

    document.addEventListener("DOMContentLoaded", async function () {
      try {
        USER = await requireLoginAsync();
        if (!USER) { document.body.style.visibility = "visible"; return; }

        document.body.style.visibility = "visible";

        if (USER.role === "admin") { window.location.replace("admin.html"); return; }

        var lo = document.getElementById("btnLogout");
        if (lo) lo.onclick = logout;

        var ok = document.getElementById("popOk");
        if (ok) ok.onclick = hideResultPopup;

        var back = document.getElementById("popBack");
        if (back) back.addEventListener("click", function (e) { if (e.target === back) hideResultPopup(); });

        var t1 = document.getElementById("tab1m");
        var t3 = document.getElementById("tab3m");
        if (t1) t1.onclick = function () { setMode(60); };
        if (t3) t3.onclick = function () { setMode(180); };

        var g = document.getElementById("btnGreen");
        var v = document.getElementById("btnViolet");
        var rr = document.getElementById("btnRed");

        if (g) g.onclick = function () { if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result."); clearSelectionUI(); this.classList.add("active"); setSelectedBet({ type: "color", value: "Green", label: "Color: Green" }); };
        if (v) v.onclick = function () { if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result."); clearSelectionUI(); this.classList.add("active"); setSelectedBet({ type: "color", value: "Violet", label: "Color: Violet" }); };
        if (rr) rr.onclick = function () { if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result."); clearSelectionUI(); this.classList.add("active"); setSelectedBet({ type: "color", value: "Red", label: "Color: Red" }); };

        var grid = document.getElementById("numGrid");
        if (grid) {
          var html = "";
          for (var i = 0; i <= 9; i++) html += '<button class="wg-num" type="button" data-num="' + i + '">' + i + '</button>';
          grid.innerHTML = html;

          grid.addEventListener("click", function (e) {
            var b = e.target.closest(".wg-num");
            if (!b) return;
            if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result.");
            var n = Number(b.getAttribute("data-num"));
            clearSelectionUI();
            b.classList.add("active");
            setSelectedBet({ type: "number", value: n, label: "Number: " + n });
          });
        }

        var bb = document.getElementById("btnBig");
        var bs = document.getElementById("btnSmall");
        if (bb) bb.onclick = function () { if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result."); clearSelectionUI(); this.classList.add("active"); setSelectedBet({ type: "bs", value: "Big", label: "Big" }); };
        if (bs) bs.onclick = function () { if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result."); clearSelectionUI(); this.classList.add("active"); setSelectedBet({ type: "bs", value: "Small", label: "Small" }); };

        var betAmt = document.getElementById("betAmt");
        if (betAmt) betAmt.addEventListener("input", function () { setText("betAmtInr", fmtINR(Number(this.value || 0))); });

        var chipsRow = document.getElementById("chipsRow");
        if (chipsRow) chipsRow.addEventListener("click", function (e) {
          var b = e.target.closest(".chipbtn");
          if (!b) return;
          var val = Number(b.getAttribute("data-chip") || 0);
          if (betAmt) { betAmt.value = String(val); setText("betAmtInr", fmtINR(val)); }
        });

        var btnBet = document.getElementById("btnBet");
        var btnClear = document.getElementById("btnClear");
        var btnRefresh = document.getElementById("btnRefresh");

        if (btnBet) btnBet.onclick = confirmBet;

        if (btnClear) btnClear.onclick = function () {
          if (activeBet) return showMsg("betMsg", "Bet already placed. Wait result.");
          clearSelectionUI();
          setSelectedBet(null);
          if (betAmt) betAmt.value = "";
          setText("betAmtInr", fmtINR(0));
          hideMsg("betMsg");
        };

        if (btnRefresh) btnRefresh.onclick = async function () {
          await renderWallet();
          await renderHistory();
          await renderLast5();
        };

        await renderWallet();
        await renderHistory();
        setMode(60);

        if (timer) clearInterval(timer);
        timer = setInterval(async function () {
          remain = remainingInModeBlock();
          setText("periodId", currentPeriodIST());
          setTimerUI(remain, MODE_SEC);
          updateBetWindowUI();
          if (remain % 2 === 0) await renderLast5();
          await settleAtZeroOnly();
        }, 500);

        setInterval(renderWallet, 1500);

      } catch (e) {
        console.error(e);
        document.body.style.visibility = "visible";
        alert("Game error: " + (e && e.message ? e.message : e));
      }
    });
  </script>
</body>
</html>

