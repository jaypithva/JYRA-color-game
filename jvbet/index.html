<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JVBET1803 - Login</title>

  <link rel="stylesheet" href="assets/css/style.css"/>
  <link rel="shortcut icon" href="assets/image/jvbet-logo.png"/>

  <style>
    .logoOnly{height:44px;margin:0 auto 14px;display:block}
    .card{max-width:520px;margin:22px auto;padding:18px;border-radius:18px}
    .msg{margin-top:10px;padding:10px;border-radius:12px;min-height:42px}
  </style>
</head>

<body class="bg">
<main class="wrap">
<section class="card">

  <img class="logoOnly" src="assets/image/jvbet-logo.png"/>
  <p style="text-align:center;opacity:.7">Welcome JVBet</p>

  <input class="input" id="id" placeholder="ClientID / Phone Number"/>
  <input class="input" id="pass" type="password" placeholder="Password" style="margin-top:10px"/>

  <button class="btn" id="loginBtn" style="width:100%;margin-top:12px">
    Login
  </button>

  <div class="msg" id="msg">Enter ID & Password</div>

</section>
</main>

<!-- âœ… Firebase CDN (NO MODULE / NO IMPORT) -->
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>

<script>
/* ================= FIREBASE INIT ================= */
firebase.initializeApp({
  apiKey: "AIzaSyCAFH5_1RjVHyZLwkj26zQPCq0-8S0fSKA",
  authDomain: "jvbet-bbf90.firebaseapp.com",
  projectId: "jvbet-bbf90",
  storageBucket: "jvbet-bbf90.appspot.com",
  messagingSenderId: "824871692224",
  appId: "1:824871692224:web:f74baa642b1f43b78aca25"
});

const db = firebase.firestore();

/* ================= HELPERS ================= */
function msg(t){ document.getElementById("msg").innerText = t; }

async function sha256(str){
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return [...new Uint8Array(buf)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

/* ================= LOGIN ================= */
document.getElementById("loginBtn").onclick = async () => {
  try{
    msg("Checking...");

    const id   = document.getElementById("id").value.trim();
    const pass = document.getElementById("pass").value;

    if(!id || !pass) throw "Enter ID & Password";

    const ref = db.collection("users").doc(id);
    const snap = await ref.get();

    if(!snap.exists) throw "User not found";

    const u = snap.data();
    if(u.isBlocked) throw "User blocked";

    // password check
    if(u.password){
      if(u.password !== pass) throw "Wrong password";
    }else if(u.passwordHash){
      const h = await sha256(pass);
      if(h !== u.passwordHash) throw "Wrong password";
    }else{
      throw "Password not set";
    }

    // save session
    localStorage.setItem("jvbet_session", JSON.stringify({
      id: id,
      role: u.role,
      name: u.name
    }));

    // redirect
    location.href = (u.role === "admin")
      ? "pages/admin.html"
      : "pages/casino.html";

  }catch(e){
    msg(e.toString());
  }
};

// Enter key
document.addEventListener("keydown",e=>{
  if(e.key==="Enter") document.getElementById("loginBtn").click();
});
</script>

</body>
</html>
